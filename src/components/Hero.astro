---
interface Pizza {
  id_producto: number;
  nombre_producto: string;
  precio_unitario: number;
  src: string;
}

let pizza: Pizza | undefined;
const index = 1; // ID del producto de promociÃ³n

try {
  const res = await fetch("http://localhost:8080/api/pizzas");
  if (res.ok) {
    const pizzas = (await res.json()) as Pizza[];
    pizza = pizzas.find((item: Pizza) => item.id_producto === index);
  }
} catch (error) {
  console.error("Error en fetch:", error);
}

// ðŸ”¹ fallback con test.json
if (!pizza) {
  const rawData = await import("../../test.json");
  const data = rawData.default as unknown;
  const pizzasFromJson: Pizza[] = Array.isArray(data) ? (data as Pizza[]) : [];
  pizza = pizzasFromJson.find((item: Pizza) => item.id_producto === index);
}
---

<section class="flex justify-end bg-[#C8102E] py-32 fade shadow-inset-bottom">
  <div>
    <img
      src="/heroImage.png"
      class="absolute left-16 top-32 w-[40%] z-0 origin-center -translate-x-1/4 Rotate-slide-in"
    />
  </div>
  <section class="relative z-10 w-[50%] fade-slide-up">
    <article class="flex flex-col">
      <h3
        class="text-2xl md:text-3xl font-bold tracking-wide text-transparent mt-8"
        style="-webkit-text-stroke: 1px white;"
      >
        <span class="text-slate-50">No te lo puedes perder!</span>
        <br />
        Promocion del mes!
      </h3>
      <h4 class="text-4xl md:text-6xl font-black text-slate-50 pb-4">
        {pizza?.nombre_producto}
      </h4>
      <p
        class="text-2xl md:text-3xl font-bold tracking-wide text-transparent mt-8"
        style="-webkit-text-stroke: 1px white;"
      >
        Adquiera por solo!
      </p>
      <span class="text-2xl md:text-3xl font-bold text-white drop-shadow-md"
        >${pizza?.precio_unitario.toFixed(2)}</span
      >
      <button
        id="hero-add-to-cart"
        class="bg-white text-[#C8102E] font-semibold px-6 py-3 rounded-lg border-2 border-[#C8102E]
        hover:bg-[#C8102E] hover:text-white shadow-inner transition-colors duration-300
        w-fit mt-6"
        data-id={pizza?.id_producto}
        data-nombre={pizza?.nombre_producto}
        data-precio={pizza?.precio_unitario}
        data-src={pizza?.src}
      >
        Ordena ahora!
      </button>
    </article>
  </section>
</section>

<script>
  import { cartStore } from "../stores/cartStore";

  document.addEventListener("DOMContentLoaded", () => {
    const button = document.getElementById("hero-add-to-cart");

    if (button) {
      button.addEventListener("click", (e) => {
        const btn = e.currentTarget as HTMLElement;
        const product = {
          id_producto: parseInt(btn.dataset.id!),
          nombre_producto: btn.dataset.nombre!,
          precio_unitario: parseFloat(btn.dataset.precio!),
          src: btn.dataset.src!,
        };

        cartStore.addItem(product);

        // AnimaciÃ³n visual
        btn.textContent = "Â¡Agregado!";
        btn.classList.add("bg-green-500", "border-green-500");
        btn.classList.remove("bg-white", "border-[#C8102E]");

        setTimeout(() => {
          btn.textContent = "Ordena ahora!";
          btn.classList.remove("bg-green-500", "border-green-500");
          btn.classList.add("bg-white", "border-[#C8102E]");
        }, 1000);
      });
    }
  });
</script>
